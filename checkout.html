<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Ø¥ØªÙ…Ø§Ù… Ø§Ù„Ø·Ù„Ø¨ | Ø§Ù„Ø¨ÙŠØª Ø§Ù„Ø±ÙˆØ³ÙŠ</title>
  <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@300;400;500;600;700;900&family=Tajawal:wght@300;400;500;700;800&display=swap" rel="stylesheet"/>
  <style>
    *, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }
    :root {
      --bg: #09090a; --surface: #111210; --card: #161713; --card2: #1c1e17;
      --border: #2a2c20; --green: #a8b845; --green2: #8fa034; --green-dim: #2a2e10;
      --white: #f5f5ee; --muted: #6b6e50; --muted2: #9a9e7a; --text: #edeee0; --red: #ff4d4d;
    }
    html { scroll-behavior: smooth; }
    body { font-family: 'Cairo', sans-serif; background: var(--bg); color: var(--text); min-height: 100vh; }

    body::before {
      content: ''; position: fixed; inset: 0;
      background-image: radial-gradient(ellipse 600px 400px at 80% 10%, rgba(168,184,69,0.06) 0%, transparent 70%);
      pointer-events: none; z-index: 0;
    }

    /* HEADER */
    header {
      background: rgba(8,11,8,0.95); backdrop-filter: blur(20px);
      border-bottom: 1px solid var(--border);
      padding: 16px 40px;
      display: flex; align-items: center; gap: 16px;
      position: sticky; top: 0; z-index: 100;
    }
    .logo { display: flex; align-items: center; gap: 12px; text-decoration: none; }
    .logo-icon { width: 40px; height: 40px; background: var(--green); border-radius: 10px; display: grid; place-items: center; font-size: 20px; }
    .logo-name { font-family: 'Tajawal', sans-serif; font-size: 18px; font-weight: 800; color: var(--white); }
    .logo-sub { font-size: 10px; color: var(--green); letter-spacing: 1px; }
    .back-btn {
      margin-right: auto; display: flex; align-items: center; gap: 8px;
      color: var(--muted2); text-decoration: none; font-size: 13px; font-weight: 600;
      transition: color 0.2s;
    }
    .back-btn:hover { color: var(--green); }

    /* MAIN */
    .main {
      max-width: 1100px; margin: 0 auto;
      padding: 40px 24px;
      display: grid; grid-template-columns: 1fr 400px;
      gap: 32px; position: relative; z-index: 5;
    }

    /* FORM */
    .form-section { display: flex; flex-direction: column; gap: 24px; }

    .form-card {
      background: var(--card); border: 1px solid var(--border);
      border-radius: 20px; padding: 32px;
    }
    .form-card-title {
      font-family: 'Tajawal', sans-serif; font-size: 20px; font-weight: 800;
      margin-bottom: 24px; display: flex; align-items: center; gap: 10px;
    }
    .form-card-title span {
      width: 32px; height: 32px; background: var(--green); color: #080b08;
      border-radius: 8px; display: grid; place-items: center;
      font-size: 14px; font-weight: 900; flex-shrink: 0;
    }

    .form-row { display: grid; grid-template-columns: 1fr 1fr; gap: 16px; }
    .form-group { display: flex; flex-direction: column; gap: 8px; }
    .form-group.full { grid-column: 1 / -1; }

    label { font-size: 13px; font-weight: 700; color: var(--muted2); }
    .required { color: var(--green); }

    input, select, textarea {
      background: var(--surface); border: 1px solid var(--border);
      border-radius: 10px; padding: 13px 16px;
      color: var(--text); font-family: 'Cairo', sans-serif; font-size: 14px;
      outline: none; transition: border-color 0.2s;
      text-align: right; width: 100%;
    }
    input:focus, select:focus, textarea:focus { border-color: var(--green); }
    input::placeholder, textarea::placeholder { color: var(--muted); }
    select option { background: var(--surface); }
    textarea { resize: vertical; min-height: 80px; }

    /* PAYMENT OPTIONS */
    .payment-opts { display: flex; flex-direction: column; gap: 12px; }
    .payment-opt {
      display: flex; align-items: center; gap: 14px;
      padding: 16px; border: 1px solid var(--border);
      border-radius: 12px; cursor: pointer; transition: all 0.2s;
    }
    .payment-opt:hover { border-color: rgba(168,184,69,0.4); }
    .payment-opt.selected { border-color: var(--green); background: rgba(168,184,69,0.05); }
    .payment-opt input[type="radio"] { display: none; }
    .radio-circle {
      width: 20px; height: 20px; border-radius: 50%;
      border: 2px solid var(--border); flex-shrink: 0;
      display: grid; place-items: center; transition: all 0.2s;
    }
    .payment-opt.selected .radio-circle { border-color: var(--green); background: var(--green); }
    .radio-dot { width: 8px; height: 8px; background: #080b08; border-radius: 50%; display: none; }
    .payment-opt.selected .radio-dot { display: block; }
    .payment-opt-info { flex: 1; }
    .payment-opt-name { font-size: 14px; font-weight: 700; }
    .payment-opt-desc { font-size: 12px; color: var(--muted2); margin-top: 2px; }
    .payment-opt-icon { font-size: 24px; }

    /* ORDER SUMMARY */
    .order-summary {
      background: var(--card); border: 1px solid var(--border);
      border-radius: 20px; padding: 28px;
      position: sticky; top: 90px; height: fit-content;
    }
    .summary-title {
      font-family: 'Tajawal', sans-serif; font-size: 20px; font-weight: 800;
      margin-bottom: 20px;
    }

    .summary-items { display: flex; flex-direction: column; gap: 12px; margin-bottom: 20px; }
    .summary-item {
      display: flex; align-items: center; gap: 12px;
      padding: 12px; background: var(--surface);
      border: 1px solid var(--border); border-radius: 10px;
    }
    .summary-item-img { font-size: 28px; width: 44px; text-align: center; }
    .summary-item-name { font-size: 13px; font-weight: 600; flex: 1; }
    .summary-item-qty { font-size: 11px; color: var(--muted); }
    .summary-item-price { font-size: 14px; font-weight: 800; color: var(--green); }

    .summary-divider { height: 1px; background: var(--border); margin: 16px 0; }

    .summary-row {
      display: flex; justify-content: space-between; align-items: center;
      margin-bottom: 10px; font-size: 13px; color: var(--muted2);
    }
    .summary-row.total {
      font-size: 16px; font-weight: 800; color: var(--text);
      margin-top: 4px;
    }
    .summary-row.total .val { color: var(--green); font-size: 22px; font-family: 'Tajawal', sans-serif; }

    .free-ship {
      background: rgba(168,184,69,0.1); border: 1px solid rgba(168,184,69,0.2);
      border-radius: 8px; padding: 10px 14px;
      font-size: 12px; color: var(--green); font-weight: 700;
      text-align: center; margin: 12px 0;
    }

    .submit-btn {
      width: 100%; background: var(--green); color: #080b08;
      border: none; border-radius: 14px; padding: 18px;
      font-size: 16px; font-weight: 900; font-family: 'Cairo', sans-serif;
      cursor: pointer; transition: all 0.25s; margin-top: 16px;
      display: flex; align-items: center; justify-content: center; gap: 10px;
    }
    .submit-btn:hover { background: var(--green2); transform: translateY(-2px); box-shadow: 0 10px 30px rgba(168,184,69,0.35); }
    .submit-btn:disabled { opacity: 0.6; cursor: not-allowed; transform: none; }

    .secure-note {
      display: flex; align-items: center; justify-content: center; gap: 8px;
      font-size: 12px; color: var(--muted); margin-top: 12px;
    }

    /* EMPTY CART */
    .empty-cart {
      grid-column: 1/-1; text-align: center; padding: 80px 20px;
    }

    /* SUCCESS OVERLAY */
    .success-overlay {
      position: fixed; inset: 0; background: rgba(0,0,0,0.85);
      z-index: 500; display: none; place-items: center;
    }
    .success-overlay.show { display: grid; }
    .success-box {
      background: var(--card); border: 1px solid rgba(168,184,69,0.3);
      border-radius: 24px; padding: 48px 40px; text-align: center;
      max-width: 480px; width: 90%;
      animation: popIn 0.4s cubic-bezier(0.4,0,0.2,1);
    }
    @keyframes popIn { from{transform:scale(0.8);opacity:0} to{transform:scale(1);opacity:1} }
    .success-icon { font-size: 72px; margin-bottom: 20px; }
    .success-title { font-family: 'Tajawal', sans-serif; font-size: 28px; font-weight: 800; margin-bottom: 10px; color: var(--green); }
    .success-msg { font-size: 15px; color: var(--muted2); line-height: 1.7; margin-bottom: 28px; }
    .success-order { background: var(--surface); border: 1px solid var(--border); border-radius: 12px; padding: 16px; margin-bottom: 24px; font-size: 13px; color: var(--muted2); }
    .success-order strong { color: var(--green); font-size: 18px; }
    .btn-home { display: inline-flex; align-items: center; gap: 8px; background: var(--green); color: #080b08; border: none; border-radius: 12px; padding: 14px 28px; font-size: 14px; font-weight: 800; font-family: 'Cairo', sans-serif; cursor: pointer; text-decoration: none; }

    /* LOADING */
    .spinner { width: 20px; height: 20px; border: 3px solid rgba(8,11,8,0.3); border-top-color: #080b08; border-radius: 50%; animation: spin 0.8s linear infinite; }
    @keyframes spin { to { transform: rotate(360deg); } }

    @media (max-width: 900px) {
      .main { grid-template-columns: 1fr; }
      .order-summary { position: static; }
      header { padding: 12px 16px; }
    }
    @media (max-width: 600px) {
      .form-row { grid-template-columns: 1fr; }
      .main { padding: 20px 16px; }
    }
  </style>
</head>
<body>

<header>
  <a class="logo" href="index.html">
    <div class="logo-icon">ğŸ‡·ğŸ‡º</div>
    <div>
      <div class="logo-name">Ø§Ù„Ø¨ÙŠØª Ø§Ù„Ø±ÙˆØ³ÙŠ</div>
      <div class="logo-sub">AL-BAIT AL-RUSSI</div>
    </div>
  </a>
  <a class="back-btn" href="index.html">â† Ø§Ù„Ø¹ÙˆØ¯Ø© Ù„Ù„ØªØ³ÙˆÙ‚</a>
</header>

<div class="main" id="mainContent">
  <!-- Ø³ÙŠØªÙ… Ø¨Ù†Ø§Ø¤Ù‡ Ø¨Ø§Ù„Ø¬Ø§ÙØ§Ø³ÙƒØ±ÙŠØ¨Øª -->
</div>

<!-- SUCCESS -->
<div class="success-overlay" id="successOverlay">
  <div class="success-box">
    <div class="success-icon">âœ…</div>
    <div class="success-title">ØªÙ… Ø§Ø³ØªÙ„Ø§Ù… Ø·Ù„Ø¨Ùƒ!</div>
    <p class="success-msg">Ø´ÙƒØ±Ø§Ù‹ Ù„Ùƒ! ØªÙ… ØªØ³Ø¬ÙŠÙ„ Ø·Ù„Ø¨Ùƒ Ø¨Ù†Ø¬Ø§Ø­ ÙˆØ³ÙŠØªÙˆØ§ØµÙ„ Ù…Ø¹Ùƒ ÙØ±ÙŠÙ‚Ù†Ø§ Ù‚Ø±ÙŠØ¨Ø§Ù‹ Ø¹Ø¨Ø± ÙˆØ§ØªØ³Ø§Ø¨ Ù„ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ø·Ù„Ø¨ ÙˆØ§Ù„Ø´Ø­Ù†.</p>
    <div class="success-order">Ø±Ù‚Ù… Ø·Ù„Ø¨Ùƒ: <br><strong id="orderNum">#000000</strong></div>
    <a class="btn-home" href="index.html">ğŸ  Ø§Ù„Ø¹ÙˆØ¯Ø© Ù„Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</a>
  </div>
</div>

<script>
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  Config
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
const SUPABASE_URL = 'https://scfynykgltftvredmvla.supabase.co';
const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InNjZnlueWtnbHRmdHZyZWRtdmxhIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NzE2MjIyNzAsImV4cCI6MjA4NzE5ODI3MH0.swEBhsm6s2bkoigELl16ia4TkY0vpMLuFn-QjShlzt0';
const WHATSAPP_PHONE = '79962196487'; // Ø±Ù‚Ù…Ùƒ

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  Cart
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function getCart() { return JSON.parse(localStorage.getItem('cart') || '[]'); }
function clearCart() { localStorage.removeItem('cart'); }

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  Build Page
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
const cart = getCart();
const main = document.getElementById('mainContent');

if (!cart.length) {
  main.innerHTML = `
    <div class="empty-cart">
      <div style="font-size:80px;margin-bottom:20px">ğŸ›’</div>
      <div style="font-family:'Tajawal',sans-serif;font-size:28px;font-weight:800;margin-bottom:10px">Ø§Ù„Ø³Ù„Ø© ÙØ§Ø±ØºØ©</div>
      <div style="color:var(--muted2);margin-bottom:28px">Ø£Ø¶Ù Ù…Ù†ØªØ¬Ø§Øª Ù„Ù„Ø³Ù„Ø© Ø£ÙˆÙ„Ø§Ù‹</div>
      <a href="index.html" style="display:inline-flex;align-items:center;gap:8px;background:var(--green);color:#080b08;border-radius:12px;padding:14px 28px;font-size:14px;font-weight:800;font-family:'Cairo',sans-serif;text-decoration:none;">â† ØªØ³ÙˆÙ‘Ù‚ Ø§Ù„Ø¢Ù†</a>
    </div>`;
} else {
  const subtotal = cart.reduce((s, i) => s + i.price * i.qty, 0);
  const shipping = subtotal >= 200 ? 0 : 25;
  const total = subtotal + shipping;

  main.innerHTML = `
    <div class="form-section">

      <!-- Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¹Ù…ÙŠÙ„ -->
      <div class="form-card">
        <div class="form-card-title"><span>1</span> Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¹Ù…ÙŠÙ„</div>
        <div class="form-row">
          <div class="form-group">
            <label>Ø§Ù„Ø§Ø³Ù… Ø§Ù„ÙƒØ§Ù…Ù„ <span class="required">*</span></label>
            <input type="text" id="custName" placeholder="Ù…Ø­Ù…Ø¯ Ø£Ø­Ù…Ø¯" required/>
          </div>
          <div class="form-group">
            <label>Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ <span class="required">*</span></label>
            <input type="tel" id="custPhone" placeholder="+966 50 000 0000" required/>
          </div>
          <div class="form-group">
            <label>Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ</label>
            <input type="email" id="custEmail" placeholder="example@email.com"/>
          </div>
          <div class="form-group">
            <label>Ø§Ù„Ø¯ÙˆÙ„Ø© <span class="required">*</span></label>
            <select id="custCountry">
              <option value="Ø§Ù„Ø³Ø¹ÙˆØ¯ÙŠØ©">ğŸ‡¸ğŸ‡¦ Ø§Ù„Ù…Ù…Ù„ÙƒØ© Ø§Ù„Ø¹Ø±Ø¨ÙŠØ© Ø§Ù„Ø³Ø¹ÙˆØ¯ÙŠØ©</option>
              <option value="Ø§Ù„Ø¥Ù…Ø§Ø±Ø§Øª">ğŸ‡¦ğŸ‡ª Ø§Ù„Ø¥Ù…Ø§Ø±Ø§Øª Ø§Ù„Ø¹Ø±Ø¨ÙŠØ© Ø§Ù„Ù…ØªØ­Ø¯Ø©</option>
              <option value="Ø§Ù„ÙƒÙˆÙŠØª">ğŸ‡°ğŸ‡¼ Ø§Ù„ÙƒÙˆÙŠØª</option>
              <option value="Ù‚Ø·Ø±">ğŸ‡¶ğŸ‡¦ Ù‚Ø·Ø±</option>
              <option value="Ø§Ù„Ø¨Ø­Ø±ÙŠÙ†">ğŸ‡§ğŸ‡­ Ø§Ù„Ø¨Ø­Ø±ÙŠÙ†</option>
              <option value="Ø¹Ù…Ø§Ù†">ğŸ‡´ğŸ‡² Ø¹ÙÙ…Ø§Ù†</option>
              <option value="Ù…ØµØ±">ğŸ‡ªğŸ‡¬ Ù…ØµØ±</option>
              <option value="Ø§Ù„Ø£Ø±Ø¯Ù†">ğŸ‡¯ğŸ‡´ Ø§Ù„Ø£Ø±Ø¯Ù†</option>
              <option value="Ø£Ø®Ø±Ù‰">ğŸŒ Ø£Ø®Ø±Ù‰</option>
            </select>
          </div>
          <div class="form-group">
            <label>Ø§Ù„Ù…Ø¯ÙŠÙ†Ø© <span class="required">*</span></label>
            <input type="text" id="custCity" placeholder="Ø§Ù„Ø±ÙŠØ§Ø¶"/>
          </div>
          <div class="form-group full">
            <label>Ø§Ù„Ø¹Ù†ÙˆØ§Ù† Ø§Ù„ØªÙØµÙŠÙ„ÙŠ <span class="required">*</span></label>
            <input type="text" id="custAddress" placeholder="Ø§Ù„Ø­ÙŠØŒ Ø§Ù„Ø´Ø§Ø±Ø¹ØŒ Ø±Ù‚Ù… Ø§Ù„Ù…Ø¨Ù†Ù‰..."/>
          </div>
          <div class="form-group full">
            <label>Ù…Ù„Ø§Ø­Ø¸Ø§Øª Ø¥Ø¶Ø§ÙÙŠØ©</label>
            <textarea id="custNotes" placeholder="Ø£ÙŠ ØªØ¹Ù„ÙŠÙ…Ø§Øª Ø®Ø§ØµØ© Ù„Ù„ØªÙˆØµÙŠÙ„..."></textarea>
          </div>
        </div>
      </div>

      <!-- Ø·Ø±ÙŠÙ‚Ø© Ø§Ù„Ø¯ÙØ¹ -->
      <div class="form-card">
        <div class="form-card-title"><span>2</span> Ø·Ø±ÙŠÙ‚Ø© Ø§Ù„Ø¯ÙØ¹</div>
        <div class="payment-opts">
          <div class="payment-opt selected" onclick="selectPayment(this, 'cod')">
            <input type="radio" name="payment" checked/>
            <div class="radio-circle"><div class="radio-dot"></div></div>
            <div class="payment-opt-info">
              <div class="payment-opt-name">Ø§Ù„Ø¯ÙØ¹ Ø¹Ù†Ø¯ Ø§Ù„Ø§Ø³ØªÙ„Ø§Ù…</div>
              <div class="payment-opt-desc">Ø§Ø¯ÙØ¹ Ù†Ù‚Ø¯Ø§Ù‹ Ø¹Ù†Ø¯ ÙˆØµÙˆÙ„ Ø§Ù„Ø·Ù„Ø¨</div>
            </div>
            <div class="payment-opt-icon">ğŸ’µ</div>
          </div>
          <div class="payment-opt" onclick="selectPayment(this, 'transfer')">
            <input type="radio" name="payment"/>
            <div class="radio-circle"><div class="radio-dot"></div></div>
            <div class="payment-opt-info">
              <div class="payment-opt-name">ØªØ­ÙˆÙŠÙ„ Ø¨Ù†ÙƒÙŠ</div>
              <div class="payment-opt-desc">Ø³ÙŠØªÙ… Ø¥Ø±Ø³Ø§Ù„ ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ø­Ø³Ø§Ø¨ Ø¹Ø¨Ø± ÙˆØ§ØªØ³Ø§Ø¨</div>
            </div>
            <div class="payment-opt-icon">ğŸ¦</div>
          </div>
          <div class="payment-opt" onclick="selectPayment(this, 'whatsapp')">
            <input type="radio" name="payment"/>
            <div class="radio-circle"><div class="radio-dot"></div></div>
            <div class="payment-opt-info">
              <div class="payment-opt-name">ÙˆØ§ØªØ³Ø§Ø¨ Pay</div>
              <div class="payment-opt-desc">Ø§Ù„ØªÙ†Ø³ÙŠÙ‚ Ø¹Ø¨Ø± ÙˆØ§ØªØ³Ø§Ø¨ Ù…Ø¨Ø§Ø´Ø±Ø©</div>
            </div>
            <div class="payment-opt-icon">ğŸ’¬</div>
          </div>
        </div>
      </div>

    </div>

    <!-- Ù…Ù„Ø®Øµ Ø§Ù„Ø·Ù„Ø¨ -->
    <div class="order-summary">
      <div class="summary-title">ğŸ›’ Ù…Ù„Ø®Øµ Ø§Ù„Ø·Ù„Ø¨</div>
      <div class="summary-items">
        ${cart.map(item => `
          <div class="summary-item">
            <div class="summary-item-img">${item.emoji}</div>
            <div class="summary-item-info" style="flex:1">
              <div class="summary-item-name">${item.name}</div>
              <div class="summary-item-qty">Ø§Ù„ÙƒÙ…ÙŠØ©: ${item.qty}</div>
            </div>
            <div class="summary-item-price">Ø±ÙŠØ§Ù„ ${(item.price * item.qty).toFixed(0)}</div>
          </div>
        `).join('')}
      </div>

      <div class="summary-divider"></div>

      <div class="summary-row"><span>Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹ Ø§Ù„Ø¬Ø²Ø¦ÙŠ</span><span>Ø±ÙŠØ§Ù„ ${subtotal.toFixed(0)}</span></div>
      <div class="summary-row"><span>Ø§Ù„Ø´Ø­Ù†</span><span>${shipping === 0 ? '<span style="color:var(--green)">Ù…Ø¬Ø§Ù†ÙŠ ğŸ‰</span>' : 'Ø±ÙŠØ§Ù„ ' + shipping}</span></div>

      ${subtotal < 200 ? `<div style="font-size:11px;color:var(--muted);text-align:center;margin:8px 0">Ø£Ø¶Ù Ø±ÙŠØ§Ù„ ${(200 - subtotal).toFixed(0)} Ù„Ù„Ø´Ø­Ù† Ø§Ù„Ù…Ø¬Ø§Ù†ÙŠ</div>` : `<div class="free-ship">ğŸ‰ Ø­ØµÙ„Øª Ø¹Ù„Ù‰ Ø´Ø­Ù† Ù…Ø¬Ø§Ù†ÙŠ!</div>`}

      <div class="summary-divider"></div>
      <div class="summary-row total">
        <span>Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ</span>
        <span class="val">Ø±ÙŠØ§Ù„ ${total.toFixed(0)}</span>
      </div>

      <button class="submit-btn" id="submitBtn" onclick="submitOrder()">
        <span id="submitText">âœ… ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ø·Ù„Ø¨</span>
      </button>

      <div class="secure-note">ğŸ”’ Ø·Ù„Ø¨Ùƒ Ù…Ø­Ù…ÙŠ ÙˆØ¢Ù…Ù† 100%</div>
    </div>
  `;
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  Payment Selection
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
let selectedPayment = 'cod';
function selectPayment(el, type) {
  selectedPayment = type;
  document.querySelectorAll('.payment-opt').forEach(o => o.classList.remove('selected'));
  el.classList.add('selected');
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  Submit Order
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
async function submitOrder() {
  const name = document.getElementById('custName')?.value.trim();
  const phone = document.getElementById('custPhone')?.value.trim();
  const city = document.getElementById('custCity')?.value.trim();
  const address = document.getElementById('custAddress')?.value.trim();
  const country = document.getElementById('custCountry')?.value;
  const email = document.getElementById('custEmail')?.value.trim();
  const notes = document.getElementById('custNotes')?.value.trim();

  if (!name || !phone || !city || !address) {
    alert('Ù…Ù† ÙØ¶Ù„Ùƒ Ø£ÙƒÙ…Ù„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø© (Ø§Ù„Ø§Ø³Ù…ØŒ Ø§Ù„Ù‡Ø§ØªÙØŒ Ø§Ù„Ù…Ø¯ÙŠÙ†Ø©ØŒ Ø§Ù„Ø¹Ù†ÙˆØ§Ù†)');
    return;
  }

  const btn = document.getElementById('submitBtn');
  btn.disabled = true;
  btn.innerHTML = '<div class="spinner"></div> Ø¬Ø§Ø±ÙŠ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø·Ù„Ø¨...';

  const cart = getCart();
  const subtotal = cart.reduce((s, i) => s + i.price * i.qty, 0);
  const shipping = subtotal >= 200 ? 0 : 25;
  const total = subtotal + shipping;

  const orderData = {
    customer_name: name,
    customer_phone: phone,
    customer_email: email || null,
    customer_address: `${country} - ${city} - ${address}`,
    customer_city: city,
    items: cart,
    total: total,
    status: 'pending',
    payment_method: selectedPayment,
    notes: notes || null
  };

  try {
    // Ø­ÙØ¸ ÙÙŠ Supabase
    const res = await fetch(`${SUPABASE_URL}/rest/v1/orders`, {
      method: 'POST',
      headers: {
        'apikey': SUPABASE_ANON_KEY,
        'Authorization': `Bearer ${SUPABASE_ANON_KEY}`,
        'Content-Type': 'application/json',
        'Prefer': 'return=representation'
      },
      body: JSON.stringify(orderData)
    });

    const saved = await res.json();
    const orderId = saved[0]?.id || Date.now();
    const orderShort = String(orderId).slice(-6).toUpperCase();

    // Ø¥Ø±Ø³Ø§Ù„ ÙˆØ§ØªØ³Ø§Ø¨
    sendWhatsApp(name, phone, city, country, address, cart, total, selectedPayment, notes, orderShort);

    // Ù…Ø³Ø­ Ø§Ù„Ø³Ù„Ø©
    clearCart();

    // Ø¹Ø±Ø¶ Ù†Ø¬Ø§Ø­
    document.getElementById('orderNum').textContent = '#' + orderShort;
    document.getElementById('successOverlay').classList.add('show');

  } catch(e) {
    console.error(e);
    btn.disabled = false;
    btn.innerHTML = 'âœ… ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ø·Ù„Ø¨';
    alert('Ø­Ø¯Ø« Ø®Ø·Ø£ØŒ Ø­Ø§ÙˆÙ„ Ù…Ø±Ø© Ø£Ø®Ø±Ù‰');
  }
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  WhatsApp Message
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function sendWhatsApp(name, phone, city, country, address, cart, total, payment, notes, orderNum) {
  const paymentNames = { cod: 'Ø§Ù„Ø¯ÙØ¹ Ø¹Ù†Ø¯ Ø§Ù„Ø§Ø³ØªÙ„Ø§Ù…', transfer: 'ØªØ­ÙˆÙŠÙ„ Ø¨Ù†ÙƒÙŠ', whatsapp: 'ÙˆØ§ØªØ³Ø§Ø¨ Pay' };

  const itemsList = cart.map(i =>
    `${i.emoji} ${i.name} Ã— ${i.qty} = Ø±ÙŠØ§Ù„ ${(i.price * i.qty).toFixed(0)}`
  ).join('\n');

  const msg = `
ğŸ›ï¸ *Ø·Ù„Ø¨ Ø¬Ø¯ÙŠØ¯ - Ø§Ù„Ø¨ÙŠØª Ø§Ù„Ø±ÙˆØ³ÙŠ*
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
ğŸ“‹ *Ø±Ù‚Ù… Ø§Ù„Ø·Ù„Ø¨:* #${orderNum}

ğŸ‘¤ *Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¹Ù…ÙŠÙ„:*
â€¢ Ø§Ù„Ø§Ø³Ù…: ${name}
â€¢ Ø§Ù„Ù‡Ø§ØªÙ: ${phone}
â€¢ Ø§Ù„Ø¯ÙˆÙ„Ø©: ${country}
â€¢ Ø§Ù„Ù…Ø¯ÙŠÙ†Ø©: ${city}
â€¢ Ø§Ù„Ø¹Ù†ÙˆØ§Ù†: ${address}

ğŸ›’ *Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª:*
${itemsList}

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
ğŸ’° *Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ: Ø±ÙŠØ§Ù„ ${total.toFixed(0)}*
ğŸ’³ *Ø·Ø±ÙŠÙ‚Ø© Ø§Ù„Ø¯ÙØ¹:* ${paymentNames[payment] || payment}
${notes ? `ğŸ“ *Ù…Ù„Ø§Ø­Ø¸Ø§Øª:* ${notes}` : ''}
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
â° ${new Date().toLocaleString('ar-SA')}
  `.trim();

  const encoded = encodeURIComponent(msg);
  const waUrl = `https://wa.me/${WHATSAPP_PHONE}?text=${encoded}`;
  window.open(waUrl, '_blank');
}
</script>
</body>
</html>
